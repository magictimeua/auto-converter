- name: Check empty descriptions
  run: |
    python3 - <<EOF
    from lxml import etree
    import os

    input_file = "converted.yml"
    output_file = "empty_checker.txt"

    if not os.path.exists(input_file):
        print(f"❌ Error: Input file '{input_file}' not found!")
        exit(1)

    with open(input_file, "r", encoding="utf-8") as f:
        content = f.read()

    try:
        root = etree.fromstring(content.encode("utf-8"))
    except etree.XMLSyntaxError:
        content = "<root>\n" + content + "\n</root>"
        root = etree.fromstring(content.encode("utf-8"))

    offers = root.xpath(".//offer")
    print(f"Знайдено офферів: {len(offers)}")

    current_ids = set()

    for offer in offers:
        offer_id = offer.get("id")
        name_el = offer.find("name")
        desc_el = offer.find("description")

        name = name_el.text.strip() if name_el is not None and name_el.text else ""
        desc = desc_el.text.strip() if desc_el is not None and desc_el.text else ""

        if desc == "" or desc == name:
            if offer_id and offer_id.strip():
                current_ids.add(offer_id.strip())

    print(f"Знайдено офферів з пустим або збігаючим описом: {len(current_ids)}")

    with open(output_file, "w", encoding="utf-8") as out:
        for cid in sorted(current_ids):
            out.write(cid + "\n")

    print(f"\nВміст файлу {output_file} (перші 10 рядків):")
    with open(output_file, "r", encoding="utf-8") as f:
        lines = f.readlines()
        for line in lines[:10]:
            print(line.strip())
    EOF
